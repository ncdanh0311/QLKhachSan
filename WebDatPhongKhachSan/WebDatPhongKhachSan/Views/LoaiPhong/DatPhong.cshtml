
@{
    ViewBag.Title = "DatPhong";
    Layout = "~/Views/Shared/LayoutPage.cshtml";
}

@model WebDatPhongKhachSan.Models.LoaiPhongDetailVM

@{
    ViewBag.Title = "Chi tiết loại phòng";
    Layout = "~/Views/Shared/LayoutPage.cshtml";

    var checkin = Model.NgayNhan.HasValue ? Model.NgayNhan.Value.ToString("yyyy-MM-dd") : "";
    var checkout = Model.NgayTra.HasValue ? Model.NgayTra.Value.ToString("yyyy-MM-dd") : "";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<style>
    .wrap {
        display: grid;
        grid-template-columns: 1.2fr .8fr;
        gap: 18px;
        align-items: start;
    }

    @@media (max-width: 992px) {
        .wrap {
            grid-template-columns: 1fr;
        }
    }

    .cardx {
        background: #fff;
        border: 1px solid rgba(0,0,0,.08);
        border-radius: 20px;
        box-shadow: 0 14px 34px rgba(0,0,0,.08);
        overflow: hidden;
    }

    .pad {
        padding: 16px;
    }

    .hero-img {
        width: 100%;
        height: 360px;
        object-fit: cover;
        display: block;
    }

    .thumbs {
        display: grid;
        grid-template-columns: repeat(3,1fr);
        gap: 10px;
        margin-top: 10px;
    }

        .thumbs img {
            width: 100%;
            height: 110px;
            object-fit: cover;
            border-radius: 14px;
            border: 1px solid rgba(0,0,0,.08);
        }

    .title {
        font-size: 1.5rem;
        font-weight: 950;
        margin: 0;
        color: #0b4ab8;
    }

    .muted {
        color: #64748b;
    }

    .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: #eef2ff;
        color: #1e40af;
        font-weight: 900;
        font-size: .8rem;
    }

    .form-control, .form-select {
        border-radius: 14px;
        padding: .8rem .9rem;
        border: 1px solid rgba(2,8,23,.12);
    }

        .form-control:focus, .form-select:focus {
            border-color: rgba(0,113,194,.55);
            box-shadow: 0 0 0 .25rem rgba(0,113,194,.15);
        }

    .btn-main {
        border-radius: 14px;
        font-weight: 950;
        padding: .9rem 1rem;
        background: linear-gradient(135deg,#0071c2,#0b84e3);
        border: 0;
        color: #fff;
        box-shadow: 0 12px 22px rgba(0,113,194,.20);
    }

    .price {
        font-size: 1.45rem;
        font-weight: 950;
    }
</style>

<div class="container py-4">

    @if (!string.IsNullOrWhiteSpace(Model.ThongBao))
    {
        <div class="alert alert-info">
            @Model.ThongBao
        </div>
    }

    <div class="wrap">
        <!-- LEFT: detail -->
        <div class="cardx">
            <img class="hero-img" src="@(Model.Gallery != null && Model.Gallery.Length > 0 ? Model.Gallery[0] : "")" alt="@Model.TenLoai" />
            <div class="pad">
                <div class="d-flex justify-content-between align-items-start gap-3">
                    <div>
                        <h2 class="title">@Model.TenLoai</h2>
                        <div class="muted mt-1">
                            <i class="fa-solid fa-hotel me-1"></i> @Model.TenKS
                            • @Model.ThanhPho, @Model.QuocGia
                        </div>
                        <div class="muted mt-1">
                            <i class="fa-solid fa-location-dot me-1"></i> @Model.DiaChi
                        </div>
                    </div>

                    <div class="text-end">
                        <span class="pill">
                            <i class="fa-solid fa-users"></i>
                            @Model.SucChuaNguoiLon NL • @Model.SucChuaTreEm TE
                        </span>
                    </div>
                </div>

                <hr />

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="fw-bold mb-1">Mô tả</div>
                        <div class="muted">
                            @(string.IsNullOrWhiteSpace(Model.MoTa)
                                ? "Không gian sạch sẽ, tiện nghi. Phù hợp nghỉ dưỡng và công tác."
                                : Model.MoTa)
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="fw-bold mb-1">Chính sách & tiện ích (demo)</div>
                        <ul class="mb-0 muted">
                            <li>Wifi miễn phí</li>
                            <li>Không hút thuốc</li>
                            <li>Hủy miễn phí trước 24h (demo)</li>
                        </ul>
                    </div>
                </div>

                @if (Model.Gallery != null && Model.Gallery.Length > 1)
                {
                    <div class="thumbs">
                        @for (int i = 1; i < Model.Gallery.Length; i++)
                        {
                            <img src="@Model.Gallery[i]" alt="thumb @i" loading="lazy" />
                        }
                    </div>
                }
            </div>
        </div>

        <!-- RIGHT: booking form -->
        <div class="cardx">
            <div class="pad">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="fw-bold">Đặt phòng</div>
                    <div class="text-end">
                        <div class="muted small">Giá cơ bản / đêm</div>
                        <div class="price">@String.Format("{0:N0} ₫", Model.GiaCoBan)</div>

                        @if (Model.GiaTheoNgay.HasValue && Model.NgayNhan.HasValue)
                        {
                            <div class="muted small mt-1">Giá theo ngày (@Model.NgayNhan.Value.ToString("yyyy-MM-dd"))</div>
                            <div class="fw-bold text-danger">@String.Format("{0:N0} ₫", Model.GiaTheoNgay.Value)</div>
                        }
                    </div>
                </div>

                <hr />

                @using (Html.BeginForm("DatPhong", "LoaiPhong", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(m => m.MaLoaiPhong)
                    @Html.HiddenFor(m => m.MaKS)

                    <div class="row g-2">
                        <div class="col-6">
                            <label class="form-label fw-bold small">Ngày nhận</label>
                            <input type="date" name="NgayNhan" value="@checkin" class="form-control" />
                        </div>
                        <div class="col-6">
                            <label class="form-label fw-bold small">Ngày trả</label>
                            <input type="date" name="NgayTra" value="@checkout" class="form-control" />
                        </div>

                        <div class="col-6">
                            <label class="form-label fw-bold small">Người lớn</label>
                            <input type="number" name="SoNguoiLon" class="form-control" min="1" value="@Model.SoNguoiLon" />
                        </div>
                        <div class="col-6">
                            <label class="form-label fw-bold small">Trẻ em</label>
                            <input type="number" name="SoTreEm" class="form-control" min="0" value="@Model.SoTreEm" />
                        </div>

                        <div class="col-6">
                            <label class="form-label fw-bold small">Số phòng</label>
                            <input type="number" name="SoPhong" class="form-control" min="1" value="@Model.SoPhong" />
                        </div>

                        <div class="col-12">
                            <label class="form-label fw-bold small">Ghi chú (tuỳ chọn)</label>
                            <textarea name="GhiChu" class="form-control" rows="3" placeholder="Ví dụ: cần giường đôi, check-in muộn...">@Model.GhiChu</textarea>
                        </div>
                    </div>

                    <div class="mt-3 p-3 rounded-4" style="background:rgba(2,8,23,.03); border:1px dashed rgba(2,8,23,.12);">
                        <div class="d-flex justify-content-between">
                            <span class="muted">Số đêm</span>
                            <b>@Model.SoDem</b>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span class="muted">Tổng tiền dự kiến</span>
                            <b class="text-danger">
                                @(Model.TongTienDuKien.HasValue ? String.Format("{0:N0} ₫", Model.TongTienDuKien.Value) : "—")
                            </b>
                        </div>
                        <div class="muted small mt-2">
                            * Giá theo ngày dựa trên ngày nhận (lễ/cuối tuần). Sau này có thể tính từng ngày.
                        </div>
                    </div>

                    <button type="submit" class="btn btn-main w-100 mt-3">
                        <i class="fa-solid fa-bolt me-2"></i>Đặt ngay
                    </button>
                }

                <a class="btn btn-outline-secondary w-100 mt-2" style="border-radius:14px;"
                   href="@Url.Action("LoaiPhong","Phong", new { maKS = Model.MaKS, ngayNhan = checkin })">
                    ← Quay lại danh sách loại phòng
                </a>
            </div>
        </div>
    </div>
</div>

